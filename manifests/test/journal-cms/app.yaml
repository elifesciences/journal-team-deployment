apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: journal-cms
  namespace: journal--test
spec:
  interval: 1m0s
  sourceRef:
    kind: GitRepository
    name: journal-team-deployment
    namespace: flux-system
  path: ./kustomizations/journal-cms/app
  prune: true
  targetNamespace: journal--test
  images:
    - name: ghcr.io/elifesciences/journal-cms
      newTag: dockerise-20250929110427-g94b9c64-18094799533-1
  dependsOn:
    - name: journal-cms-aws-role
  postBuild:
    substituteFrom:
      - kind: ConfigMap
        name: journal-cms-role
    substitute:
      # deployment vars
      env: test

      journal_cms_database_host: journal-cms-database-haproxy
      journal_cms_database_name: journal_cms
      journal_cms_database_username: root
      journal_cms_database_password_secret_name: journal-cms-database-secrets
      journal_cms_database_password_secret_key: root

      journal_cms_redis_host: journal-cms-cache
